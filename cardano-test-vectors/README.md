# cardano-test-vectors

A fixture crate that embeds the official Cardano VRF, DSIGN, KES, hash, and
auxiliary test vectors so other crates can access them without touching the
filesystem. All JSON artefacts are compiled into the binary, providing a stable
and portable source of truth for regression tests and cross-language parity
checks.

## Highlights

- **In-memory fixtures** – exposes VRF, DSIGN, KES, hash, and BLS12-381 data via
    `&'static str`, eliminating runtime I/O.
- **Feature-gated diagnostics** – optional tracing (`ed25519-debug`) mirrors the
    Cardano debugging workflow used in `cardano-crypto-class` and `cardano-vrf-pure`.
- **Deterministic generators** – binaries regenerate DSIGN/KES/hash corpora from
    first principles, guaranteeing parity with the Rust implementations.
- **CLI tooling** – helper binaries (e.g. `compare_hash_vectors`) validate newly
    produced JSON against the committed reference set.
- **Workspace integration** – consumed by cryptographic crates across the
    repository, keeping their regression suites hermetic.

## Crate layout

| Path | Purpose |
|------|---------|
| `src/lib.rs` | Public surface exposing `vrf`, `dsign`, `kes`, `hash`, and BLS12-381 helpers. |
| `src/debug.rs` | Feature-gated logging utilities used during DSIGN development (`ed25519-debug`). |
| `test_vectors/` | Embedded JSON fixtures regenerated by workspace tooling. |
| `tests/` | Regression suites for VRF/DSIGN/KES/hash corpora plus performance and tracing harnesses. |

```
cardano-test-vectors/
├── src/lib.rs
├── src/debug.rs
├── test_vectors/
│   ├── ed25519_test_vectors.json
│   ├── ecdsa_secp256k1_test_vectors.json
│   ├── schnorr_secp256k1_test_vectors.json
│   ├── hash_test_vectors.json
│   ├── compact_sum_kes_test_vectors.json
│   ├── sum_kes_period_evolution_vectors.json
│   ├── compact_sum_kes_period_evolution_vectors.json
│   ├── vrf_ver03_standard_10 … vrf_ver03_standard_12
│   ├── vrf_ver13_* and generated_* series
│   └── bls12-381/
│       ├── bls_sig_aug_test_vectors
│       ├── ec_operations_test_vectors
│       ├── h2c_large_dst
│       ├── pairing_test_vectors
│       └── serde_test_vectors
└── tests/
    ├── debug_ed25519_trace.rs
    ├── performance.rs
    ├── dsign_ed25519_vectors.rs
    └── kes_vectors.rs
```

### VRF vectors

The crate bundles the 14 official VRF fixtures published with Cardano’s
libsodium reference implementation:

- Draft-03 standard vectors (`vrf_ver03_standard_{10,11,12}`)
- Draft-03 generated vectors (`vrf_ver03_generated_{1-4}`)
- Draft-13 standard vectors (`vrf_ver13_standard_{10-12}`)
- Draft-13 generated vectors (`vrf_ver13_generated_{1-4}`)

All files are verbatim copies of the upstream JSON manifests and are available
through `cardano_test_vectors::vrf::{get,names,ALL}`.

### DSIGN vectors

Phase 04 DSIGN work migrated the signature fixtures from
`cardano-crypto-class/test_vectors` into this crate. The following files are
kept alongside the VRF set:

| File | Algorithms Covered | Notes |
|------|--------------------|-------|
| `ed25519_test_vectors.json` | Ed25519 deterministic signing | 4 sign/verify cases from Haskell reference, empty/max message coverage |
| `ecdsa_secp256k1_test_vectors.json` | Deterministic ECDSA (RFC 6979) | Sign/verify pairs, verify-only fixtures, negative-s rejection, malformed key lengths |
| `schnorr_secp256k1_test_vectors.json` | Schnorr secp256k1 | Sign/verify pairs plus failure cases for malformed signatures |

The Ed25519 vectors are also used for the RFC 8032 parity checks in
`cardano-crypto-class`.

### Hash vectors

`hash_test_vectors.json` captures baseline digests for the hashing helpers in
`cardano-crypto-class::hash`. The corpus covers:

- canonical sanity checks (`""`, `"hello world"`, and the ascending byte
    sequence used by existing harnesses),
- SHA-2 block boundaries (63/64/65 byte sequential inputs),
- SHA3-256 rate boundaries (136/137 byte inputs),
- a 1024-byte multi-block pattern (0x00–0xff repeated),
- single-byte edge cases, and
- composite real-world fixtures: the Bitcoin genesis block header, the
    corresponding uncompressed public key (hash160 of which yields the first
    P2PKH address), and an RLP-encoded Ethereum legacy transaction used in the
    official go-ethereum documentation.

Each vector stores SHA-256, double SHA-256, SHA-512, SHA3-256, SHA3-512,
Keccak-256, RIPEMD-160, Hash160, Blake2b-224, Blake2b-256, and Blake2b-512 outputs. The
fixture is regenerated with:

```bash
cargo run -p cardano-test-vectors --bin generate_hash_vectors
```

The generator derives all digests via the Rust implementations to guarantee the
JSON stays in sync with `cardano-crypto-class`. Future work will append
Haskell-confirmed digests and streaming edge cases.

To cross-check a Haskell-produced corpus (e.g. generated with
`scripts/HashVectors.hs` from `cardano-base`), run the comparator:

```bash
cargo run -p cardano-test-vectors --bin compare_hash_vectors \
    /path/to/hash_vectors_haskell.json
```

The optional second argument points to an alternate Rust JSON file; by default
the tool compares the reference file against the committed
`test_vectors/hash_test_vectors.json`.

### KES vectors

`generate_kes_vectors.rs` mirrors the hierarchy from
`Cardano.Crypto.KES.Sum`, emitting deterministic fixtures for:

- `single_kes_test_vectors.json` – 12 SingleKES level 0 vectors spanning
    canonical seeds, reversed-byte fixtures, and deterministically generated
    parity coverage
- `compact_single_kes_test_vectors.json` – 12 CompactSingleKES vectors with
    embedded verification-key parity matching the SingleKES corpus
- `sum_kes_test_vectors.json` – SumKES levels 1–7, 32 deterministic seeds per
    level with tracked period subsets for regression coverage
- `compact_sum_kes_test_vectors.json` – CompactSumKES levels 1–7, using the
    new recursive verification-key reconstruction to keep compact trees in
    lockstep with their SumKES counterparts
- `sum_kes_period_evolution_vectors.json` – SumKES evolution traces with every
    period recorded for six representative seeds across the hierarchy
- `compact_sum_kes_period_evolution_vectors.json` – CompactSumKES counterpart
    to the evolution traces, guaranteeing compact verification parity for the
    same seed subset

The top-level test `tests/kes_vectors.rs` consumes these files to assert
signature stability and to cross-check the period boundaries for every level.

### BLS12-381 vectors

To support the upcoming BLS12-381 pairing and signature work (see
`Cardano.Crypto.BLS12_381` in the Haskell repository) this crate now embeds the
official fixtures from `cardano-crypto-tests/bls12-381-test-vectors/test_vectors`:

- `bls_sig_aug_test_vectors` – augmented signature suites
- `ec_operations_test_vectors` – group arithmetic checks
- `h2c_large_dst` – hash-to-curve inputs with large domain separation tags
- `pairing_test_vectors` – bilinear pairing validation inputs
- `serde_test_vectors` – serialization/deserialization round-trips

The files are exposed via `cardano_test_vectors::bls12_381::{ALL,get,names}` so
consumers can access them without touching the filesystem.

## Haskell ↔ Rust mapping

| Haskell artefact | Rust counterpart | Notes |
|------------------|-----------------|-------|
| `Cardano.Crypto.VRF` fixtures (`vrf_ver*`) | `cardano_test_vectors::vrf::{ALL,get}` | Draft-03 and draft-13 suites mirrored verbatim. |
| `Cardano.Crypto.DSIGN` vectors | `cardano_test_vectors::dsign::{ed25519, ecdsa, schnorr}` | Deterministic signing corpora used by `cardano-crypto-class`. |
| `Cardano.Crypto.KES.Sum` generators | `cardano_test_vectors::kes::{compact_sum, sum, evolution}` | Deterministic corpora (Single/CompactSingle/Sum/CompactSum). |
| `Cardano.Crypto.Hash` reference digests | `cardano_test_vectors::hash::{ALL,get}` | Multi-algorithm digest catalogue with CLI comparator. |
| `cardano-crypto-tests/bls12-381-test-vectors` | `cardano_test_vectors::bls12_381::{ALL,get}` | Group arithmetic, pairing, and serde fixtures. |

## Using the crate

```rust
use cardano_test_vectors::{dsign, vrf};

// Iterate over all Ed25519 fixtures
for entry in dsign::ed25519::ALL {
    let raw = entry.contents();
    let vector: serde_json::Value = serde_json::from_str(raw)?;
    println!("{} => {} vectors", entry.name(), vector["vectors"].as_array().unwrap().len());
}

// Fetch a single VRF vector by name
if let Some(raw) = vrf::get("vrf_ver03_standard_10") {
    let parsed: serde_json::Value = serde_json::from_str(raw)?;
    // … run the test harness …
}
```

All helpers return `&'static str` so there is no runtime I/O. Consumers can
bring the module paths they need: `cardano_test_vectors::dsign::ed25519` or
`cardano_test_vectors::vrf`.

## Debugging support

Add the optional feature gate for verbose logging while developing DSIGN test
harnesses:

```bash
cargo test -p cardano-test-vectors --features ed25519-debug -- --nocapture
```

When the feature is enabled and `CARDANO_ED25519_DEBUG=1` is present in the
environment, bodies inside `cardano_test_vectors::debug::log` will emit their
messages. This mirrors the VRF crate’s diagnostics strategy so all cryptographic
modules share the same tooling.

## Regenerating vectors

### DSIGN

```bash
./.github/scripts/generate_dsign_test_vectors.sh
```

Downloads the Ed25519, ECDSA, and Schnorr corpora from the Haskell reference
repository and writes them into `test_vectors/`.

### KES

```bash
cargo run -p cardano-test-vectors --bin generate_kes_vectors
```

Regenerates Single/CompactSingle/Sum/CompactSum datasets plus the tracked-period
and full-evolution suites using deterministic seeds.

### Hash

```bash
cargo run -p cardano-test-vectors --bin generate_hash_vectors
```

Produces the multi-algorithm digest catalogue (SHA-2/SHA-3/Keccak/RIPEMD160/
Hash160/Blake2b) used by `cardano-crypto-class::hash` and the comparator CLI.

## Tests

```bash
cargo test -p cardano-test-vectors
```

The crate ships with lightweight regression tests:

- `debug_ed25519_trace.rs` – dumps trace output for the first Ed25519 vector,
  helpful when chasing parity issues
- `performance.rs` – measures signing/verification throughput (200 iterations)
- `dsign_ed25519_vectors.rs` – referenced by `cardano-crypto-class` for
  RFC 8032 parity checks
- `kes_vectors.rs` – consumes every Sum/CompactSum evolution fixture to ensure
    signature stability across levels and periods

**Latest validation:** `cargo test -p cardano-test-vectors` completed on
2025-10-08 confirming that all embedded VRF, DSIGN (Ed25519 / ECDSA / Schnorr),
hash, and KES fixture suites load and pass their associated regressions. KES
evolution fixtures and tracked-period corpora were regenerated prior to this
run; vector counts are enforced by the tests to guard against accidental
shrinkage. Cross-language spot checks for newly added KES structural invariants
plus hash parity streaming cases and Haskell-derived fixtures are queued in a
follow‑up task.

All suites pass under the default workspace toolchain.
